# 设计原则

CnosDB应用时间序列数据的优化设计原则。其中一些设计原则可能与性能方面的权衡有关。主要设计原则包括：

- 以时间为顺序的数据
- 严格的更新和删除权限
- 预处理读写查询
- 无Schema设计
- 单个Point上的数据集
- 重复数据

### 以时间为顺序的数据

  为了提高性能，数据按时间升序写入。

### 严格的更新和删除权限

  为了提高查询和写性能，CnosDB严格限制更新和删除权限。时间序列数据主要是从未更新的新数据。限制删除可以有效提高查询和写入性能。

### 优先处理读写查询

  CnosDB优先考虑读和写请求，而不是强一致性。CnosDB在执行查询时返回结果。所有影响查询数据的事务随后都会被处理，以确保数据最终是一致的。因此，如果摄取速率很高(每毫秒多个写操作)，查询结果可能不包括最近的数据。

### 无Schema设计

  CnosDB使用无Schema设计来更好地管理不连续数据。时间序列数据通常是短暂的，这意味着数据出现一段时间，然后就消失了。

### 单个Point是不重要的

  由于数据集比单个Point更重要，因此CnosDB实现了强大的工具来聚合数据和处理大型数据集。Point通过时间戳和序列来区分，所以没有传统意义上的ID。

### 重复数据

  为了简化冲突解决和提高写性能，CnosDB假设发送多次的数据是重复数据。相同的点不会存储两次。如果为某个点提交了新的字段值，则CnosDB使用最新的字段值更新该点。在极少数情况下，数据可能会被覆盖。

## 设计见解

  每个CnosDB用例都是唯一的，您的Schema反映了这种唯一性。通常，为查询而设计的模式可以实现更简单、更高效的查询。对于大多数用例，我们推荐以下设计架构:

  - 在何处存储数据(标签或字段)
  - 避免过多的series
  - 使用推荐的命名约定
  - 分片时长管理

### 在何处存储数据(标签或字段)

  - 将常用查询和分组元数据存储在标签中。
  - 如果每个数据点包含不同的值，则将数据存储在字段中。
  - 将数字值存储为fields(tag values只支持字符串值)。

### 避免过多的series

  按tags查询比按fields查询性能更好。但是，当创建过多的索引时，写和读都可能开始变慢。

  每一组索引数据元素形成一个series key。包含高度可变信息(如唯一id、哈希值和随机字符串)的标记将导致大量的series，也称为高series基数。对于许多数据库工作负载来说，高series基数是高内存使用量的主要驱动因素。因此，为了减少内存消耗，可以考虑将高基数值存储在field values中，而不是存储在tag keys或field keys中。

### 使用推荐的命名约定

  - 避免在tag和field keys中保留关键字
  - 如果每个数据点包含不同的值，则将数据存储在field中。
  - 将数字值存储为fields(tag values只支持字符串值)。